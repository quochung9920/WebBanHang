CKEDITOR.dialog.add("leaflet",function(e){var t,a="",l=e.lang.leaflet,n=e.lang.common;return{title:l.dialogTitle,minWidth:320,minHeight:125,contents:[{id:"location_tab",label:l.locationTabLabel,elements:[{id:"map_geocode",className:"geocode",type:"text",label:l.googleSearchFieldLabel,style:"margin-top: -7px;",setup:function(e){this.setValue("")},onLoad:function(a){var n=this.getInputElement().$;jQuery(".geocode input").attr("placeholder",l.googleSearchFieldHint);var i=e.config,o="AIzaSyA9ySM6msnGm0qQB1L1cLTMBdKEUKPySmQ";"undefined"!=typeof i.leaflet_maps_google_api_key&&""!=i.leaflet_maps_google_api_key&&(o=i.leaflet_maps_google_api_key),"undefined"==typeof google?CKEDITOR.scriptLoader.load("//maps.googleapis.com/maps/api/js?libraries=places&callback=dummy&key="+o,function(){t=new google.maps.places.Autocomplete(n)}):t=new google.maps.places.Autocomplete(n);var s=jQuery('<style type="text/css" />');s.html(".pac-container { z-index: 100000 !important;} input.minimap { margin-top: 18px !important; }"),jQuery("head").append(s)}},{type:"html",id:"map_label",className:"label",style:"margin-bottom: -10px;",html:"<p>"+l.manualCoordinatesFieldLabel+"</p>"},{type:"hbox",widths:["50%","50%"],children:[{id:"map_latitude",className:"latitude",type:"text",label:l.manualLatitudeFieldLabel,setup:function(e){if(""!==e.element.data("lat")){""===a&&(a=e.element.getChild(0).$.contentDocument.getElementById("map_container"));var t=a.getAttribute("data-lat");this.setValue(t)}}},{id:"map_longitude",className:"longitude",type:"text",label:l.manualLongitudeFieldLabel,setup:function(e){if(""!==e.element.data("lat")){""===a&&(a=e.element.getChild(0).$.contentDocument.getElementById("map_container"));var t=a.getAttribute("data-lon");this.setValue(t)}}}]},{id:"popup_text",className:"popup-text",type:"text",label:l.popupTextFieldLabel,style:"margin-bottom: 8px;",setup:function(e){""!=e.element.data("popup-text")?this.setValue(e.element.data("popup-text")):this.getInputElement().setAttribute("placeholder",l.popupTextFieldHint)}}]},{id:"options_tab",label:l.optionsTabLabel,elements:[{type:"hbox",style:"margin-top: -7px;",widths:["38%","38%","24%"],children:[{id:"width",className:"map_width",type:"text",label:l.mapWidthFieldLabel,setup:function(e){this.getInputElement().setAttribute("placeholder","400"),""!=e.element.data("width")&&this.setValue(e.element.data("width"))}},{id:"height",className:"map_height",type:"text",label:l.mapHeightFieldLabel,setup:function(e){this.getInputElement().setAttribute("placeholder","400"),""!=e.element.data("height")&&this.setValue(e.element.data("height"))}},{id:"map_zoom",className:"zoom",type:"select",label:l.mapZoomLevelFieldLabel,width:"70px",items:[["1"],["2"],["3"],["4"],["5"],["6"],["7"],["8"],["9"],["10"],["11"],["12"],["13"],["14"],["15"],["16"],["17"],["18"],["19"],["20"]],setup:function(e){if(""!=e.element.data("zoom")){""===a&&(a=e.element.getChild(0).$.contentDocument.getElementById("map_container"));var t=a.getAttribute("data-zoom");this.setValue(t)}else this.setValue("10")}}]},{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"map_tile",className:"tile",label:l.baseMapTileLabel,items:[["OpenStreetMap.Mapnik"],["OpenStreetMap.DE"],["OpenStreetMap.HOT"],["Esri.DeLorme"],["Esri.NatGeoWorldMap"],["Esri.WorldPhysical"],["Esri.WorldTopoMap"],["Thunderforest.OpenCycleMap"],["Thunderforest.Landscape"],["Stamen.Watercolor"]],setup:function(e){var t=["MapQuestOpen.Aerial","MapQuestOpen.OSM"],a=e.element.data("tile");""!=a&&-1==t.indexOf(a)?this.setValue(a):this.setValue("OpenStreetMap.Mapnik")},commit:function(e){var t=this.getDialog();e.element.setHtml("");var a,l,n=t.getContentElement("location_tab","map_geocode").getValue();if(""!=n){var i="//maps.googleapis.com/maps/api/geocode/json?address="+n+"&sensor=false";jQuery.ajaxSetup({async:!1}),jQuery.getJSON(i,function(e){"ZERO_RESULTS"!=e.status?(a=e.results[0].geometry.location.lat,l=e.results[0].geometry.location.lng):alert("The Place could not be Geocoded properly. Kindly choose another one.")})}var o=t.getContentElement("location_tab","map_latitude").getValue(),s=t.getContentElement("location_tab","map_longitude").getValue(),m=e.element.data("lat"),p=e.element.data("lon");""!=o&&""!=s&&(o!=m&&s!=p||""==n)&&(a=o,l=s);var d=t.getContentElement("options_tab","width").getValue()||"400",r=t.getContentElement("options_tab","height").getValue()||"400",u=t.getContentElement("options_tab","map_zoom").getValue(),g=t.getContentElement("location_tab","popup_text").getValue(),c=t.getContentElement("options_tab","map_tile").getValue(),h=t.getContentElement("options_tab","map_alignment").getValue(),b=t.getContentElement("options_tab","map_mini").getValue()?"on":"off",f=(new Date).getTime();e.element.setAttribute("id","leaflet_div-"+f),e.element.data("lat",a),e.element.data("lon",l),e.element.data("width",d),e.element.data("height",r),e.element.data("zoom",u),e.element.data("popup-text",g),e.element.data("tile",c),e.element.data("minimap",b),e.element.data("alignment",h),e.element.removeClass("align-left"),e.element.removeClass("align-right"),e.element.removeClass("align-center"),e.element.addClass("align-"+h);var _=t.getContentElement("options_tab","map_responsive").getValue()?"on":"off";"off"===_?e.element.removeClass("responsive-map"):e.element.addClass("responsive-map"),e.element.data("responsive",_),mapParserPathFull=mapParserPath+"?lat="+a+"&lon="+l+"&width="+d+"&height="+r+"&zoom="+u+"&text="+g+"&tile="+c+"&minimap="+b+"&responsive="+_;var y=new CKEDITOR.dom.element("iframe");y.setAttributes({scrolling:"no",id:"leaflet_iframe-"+f,"class":"leaflet_iframe",width:d+"px",height:r+"px",frameborder:0,allowTransparency:!0,src:mapParserPathFull,"data-cke-saved-src":mapParserPathFull}),"on"==_&&y.setAttribute("class","leaflet_iframe responsive-map-iframe"),e.element.append(y)}},{type:"checkbox",id:"map_mini",className:"minimap",label:l.minimapCheckboxLabel,setup:function(e){""!=e.element.data("minimap")&&"on"!=e.element.data("minimap")?this.setValue(""):this.setValue("true")}}]},{type:"hbox",widths:["20%","80%"],children:[{id:"map_alignment",className:"alignment",type:"select",label:n.align,items:[[n.alignLeft,"left"],[n.alignRight,"right"],[n.alignCenter,"center"]],style:"margin-bottom: 4px;",setup:function(e){""!=e.element.data("alignment")?this.setValue(e.element.data("alignment")):this.setValue("left")}},{type:"checkbox",id:"map_responsive",className:"responsive",label:l.responsiveMapCheckboxLabel,style:"margin-top: 18px;",setup:function(e){""!=e.element.data("responsive")&&"on"==e.element.data("responsive")?this.setValue("true"):this.setValue("")}}]}]}],onHide:function(){a=""}}});
